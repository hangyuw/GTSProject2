{
	"name": "dataflow1",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "business_json",
						"type": "DatasetReference"
					},
					"name": "business"
				},
				{
					"dataset": {
						"referenceName": "checkin_jason",
						"type": "DatasetReference"
					},
					"name": "checkin"
				},
				{
					"dataset": {
						"referenceName": "review_jason",
						"type": "DatasetReference"
					},
					"name": "review"
				},
				{
					"dataset": {
						"referenceName": "tip_jason",
						"type": "DatasetReference"
					},
					"name": "tip"
				},
				{
					"dataset": {
						"referenceName": "user_json",
						"type": "DatasetReference"
					},
					"name": "user"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "flatten1"
				},
				{
					"name": "flatten2"
				},
				{
					"name": "flatten3"
				},
				{
					"name": "DistinctBusiness",
					"description": "make business json distinct by business_id"
				},
				{
					"name": "DistinctCheckin",
					"description": "make checkin json distinct by business_id"
				},
				{
					"name": "DistinctReview",
					"description": "make review distinct by review_id"
				},
				{
					"name": "flatten4"
				},
				{
					"name": "DistinctTip",
					"description": "make tip distinct by user_id AND data"
				},
				{
					"name": "flatten5"
				}
			],
			"scriptLines": [
				"source(output(",
				"          business_id as string,",
				"          name as string,",
				"          address as string,",
				"          city as string,",
				"          state as string,",
				"          postal_code as string,",
				"          latitude as double,",
				"          longitude as double,",
				"          stars as double,",
				"          review_count as integer,",
				"          is_open as integer,",
				"          attributes as (ByAppointmentOnly as string, BusinessAcceptsCreditCards as string, BikeParking as string, RestaurantsPriceRange2 as string, CoatCheck as string, RestaurantsTakeOut as string, RestaurantsDelivery as string, Caters as string, WiFi as string, BusinessParking as string, WheelchairAccessible as string, HappyHour as string, OutdoorSeating as string, HasTV as string, RestaurantsReservations as string, DogsAllowed as string, Alcohol as string, GoodForKids as string, RestaurantsAttire as string, Ambience as string, RestaurantsTableService as string, RestaurantsGoodForGroups as string, DriveThru as string, NoiseLevel as string),",
				"          categories as string,",
				"          hours as (Monday as string, Tuesday as string, Wednesday as string, Thursday as string, Friday as string, Saturday as string, Sunday as string)",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'documentPerLine') ~> business",
				"source(output(",
				"          business_id as string,",
				"          date as date",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'documentPerLine') ~> checkin",
				"source(output(",
				"          review_id as string,",
				"          user_id as string,",
				"          business_id as string,",
				"          stars as double,",
				"          useful as integer,",
				"          funny as integer,",
				"          cool as integer,",
				"          text as string,",
				"          date as date",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'documentPerLine') ~> review",
				"source(output(",
				"          user_id as string,",
				"          business_id as string,",
				"          text as string,",
				"          date as date,",
				"          compliment_count as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'documentPerLine') ~> tip",
				"source(output(",
				"          user_id as string,",
				"          name as string,",
				"          review_count as integer,",
				"          yelping_since as string,",
				"          useful as integer,",
				"          funny as integer,",
				"          cool as integer,",
				"          elite as string,",
				"          friends as string,",
				"          fans as integer,",
				"          average_stars as double,",
				"          compliment_hot as integer,",
				"          compliment_more as integer,",
				"          compliment_profile as integer,",
				"          compliment_cute as integer,",
				"          compliment_list as integer,",
				"          compliment_note as integer,",
				"          compliment_plain as integer,",
				"          compliment_cool as integer,",
				"          compliment_funny as integer,",
				"          compliment_writer as integer,",
				"          compliment_photos as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'documentPerLine') ~> user",
				"business foldDown(unroll(),",
				"     mapColumn(",
				"          business_id,",
				"          name,",
				"          address,",
				"          city,",
				"          state,",
				"          postal_code,",
				"          latitude,",
				"          longitude,",
				"          stars,",
				"          review_count,",
				"          is_open,",
				"          attributes,",
				"          categories,",
				"          hours",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten1",
				"checkin foldDown(unroll(),",
				"     mapColumn(",
				"          business_id,",
				"          date",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten2",
				"review foldDown(unroll(),",
				"     mapColumn(",
				"          review_id,",
				"          user_id,",
				"          business_id,",
				"          stars,",
				"          useful,",
				"          funny,",
				"          cool,",
				"          text,",
				"          date",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten3",
				"flatten1 aggregate(groupBy(business_id)) ~> DistinctBusiness",
				"flatten2 aggregate(groupBy(business_id)) ~> DistinctCheckin",
				"flatten3 aggregate(groupBy(review_id)) ~> DistinctReview",
				"tip foldDown(unroll(),",
				"     mapColumn(",
				"          user_id,",
				"          business_id,",
				"          text,",
				"          date,",
				"          compliment_count",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten4",
				"flatten4 aggregate(groupBy(user_id,",
				"          date)) ~> DistinctTip",
				"user foldDown(unroll(),",
				"     mapColumn(",
				"          user_id,",
				"          name,",
				"          review_count,",
				"          yelping_since,",
				"          useful,",
				"          funny,",
				"          cool,",
				"          elite,",
				"          friends,",
				"          fans,",
				"          average_stars,",
				"          compliment_hot,",
				"          compliment_more,",
				"          compliment_profile,",
				"          compliment_cute,",
				"          compliment_list,",
				"          compliment_note,",
				"          compliment_plain,",
				"          compliment_cool,",
				"          compliment_funny,",
				"          compliment_writer,",
				"          compliment_photos",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten5"
			]
		}
	}
}